{
  "version": 3,
  "sources": ["../src/index.ts", "../src/effect.ts", "../../shared/src/index.ts", "../src/baseHandler.ts", "../src/reactive.ts", "../src/computed.ts", "../src/watch.ts", "../src/ref.ts"],
  "sourcesContent": ["export { effect } from './effect'\nexport { reactive } from './reactive'\nexport { computed } from './computed'\nexport { watch } from './watch'\nexport { ref,toRef } from './ref'", "export let activeEffect = undefined\nconst targetMap = new WeakMap()\n\nfunction cleanEffect(effect){\n    // \u9700\u8981\u6E05\u7406effect\u4E2D\u5B58\u5165\u5C5E\u6027\u4E2D\u7684set\u4E2D\u7684effect\n\n    // \u6BCF\u6B21\u6267\u884C\u524D\u90FD\u9700\u8981\u8BB2effect\u5BF9\u5E94\u7684\u5C5E\u6027\u7684set\u5220\u9664\n    let deps = effect.deps\n    for(let i = 0;i<deps.length;i++){\n        deps[i].delete\n    }\n    effect.deps.length = 0\n}\n\nexport class ReactiveEffect {\n    public active = true\n    public parent = undefined\n    public deps = [] // effect\u4E2D\u7528\u4E86 \u54EA\u4E9B\u5C5E\u6027\uFF0C\u540E\u7EED\u6E05\u7406\u4F7F\u7528\n    constructor(public fn,public scheduler?){}\n    run(){\n        if(!this.active){\n            return this.fn()\n        }else{\n            try {\n                this.parent = activeEffect\n                activeEffect = this\n                cleanEffect(this)\n                // \u4F9D\u8D56\u6536\u96C6 \u8BA9\u5C5E\u6027\u548Ceffect\u4EA7\u751F\u5173\u8054\n               return this.fn();\n            } finally{\n                // \u53D6\u6D88\u5F53\u524D\u6B63\u5728\u8FD0\u884C\u7684effect\n                activeEffect = this.parent;\n                this.parent = null;\n            }            \n        }\n        \n    }\n\n    stop(){\n        if(this.active){\n            this.active = false\n            cleanEffect(this)\n        }\n    }\n}\n\n\nexport function track(target,key){\n    if(activeEffect){\n        let depsMap = targetMap.get(target)\n        // \u505A\u4F9D\u8D56\u6536\u96C6\n        if(!depsMap){\n            targetMap.set(target,(depsMap = new Map()))\n        }\n\n        let deps = depsMap.get(key)\n        if(!deps){\n            depsMap.set(key,(deps = new Set()))\n        }\n        let shouldTrack = !deps.has(activeEffect)\n        if(shouldTrack) {\n            deps.add(activeEffect)\n            activeEffect.deps.push(deps)\n        }\n    }\n    // \u8BA9\u5C5E\u6027\u8BB0\u5F55\u6240\u7528\u5230\u7684effect\u662F\u8C01 \u54EA\u4E2Aeffect\u5BF9\u5E94\u4E86\u54EA\u4E9B\u5C5E\u6027\n}\n\nexport function triggerEffects(effects) { \n    effects = new Set(effects);\n    for (const effect of effects) {\n        if (effect !== activeEffect) { // \u5982\u679Ceffect\u4E0D\u662F\u5F53\u524D\u6B63\u5728\u8FD0\u884C\u7684effect\n            if (effect.scheduler) {\n                effect.scheduler()\n            } else {\n                effect.run(); // \u91CD\u65B0\u6267\u884C\u4E00\u904D\n            }\n        }\n    }\n}\nexport function trackEffects(dep) { // \u6536\u96C6dep \u5BF9\u5E94\u7684effect\n    let shouldTrack = !dep.has(activeEffect)\n    if (shouldTrack) {\n        dep.add(activeEffect);\n        activeEffect.deps.push(dep); \n    }\n}\nexport function trigger(target,key,value){\n    let depsMap = targetMap.get(target)\n    if(!depsMap){\n        return // \u5C5E\u6027\u6CA1\u6709\u4F9D\u8D56\u4EFB\u4F55\u7684effect\n    }\n\n    let effects = depsMap.get(key)\n    if(effects){\n        effects =  new Set(effects)\n        effects && effects.forEach(effect =>{\n        // \u662F\u81EA\u5DF1\u7684\u65F6\u5019\u5C31\u4E0D\u6267\u884C\n        if(effect !== activeEffect){\n            if(effect.scheduler){\n                effect.scheduler() // \u53EF\u4EE5\u63D0\u4F9B\u8C03\u5EA6\u51FD\u6570 \u7528\u6237\u5B9E\u73B0\u81EA\u5DF1\u7684\u903B\u8F91\n            }else{\n                effect.run() // \u6570\u636E\u53D8\u5316\u4E86 \u627E\u5230\u5BF9\u5E94\u7684effect\n            }\n        }\n        })\n    }\n   \n\n}\n\nexport function effect(fn,options = {} as any) {\n\n    const _effect = new ReactiveEffect(fn,options.scheduler)\n    _effect.run()\n    // \u66F4\u6539runner\u4E2D\u7684this \uFF0C\u6C38\u8FDC\u4E3A\u5F53\u524D\u7684effect\n    const runner = _effect.run.bind(_effect)\n    runner.effect = _effect\n    return runner //\u7528\u6237\u53EF\u4EE5\u624B\u52A8\u8C03\u7528runner\n}", "export const isObject = (value) => {\n    return typeof value === 'object' && value !== null\n}\n\nexport const isFunction = (value)=>{\n    return typeof value === 'function'\n}", "import { isObject } from '@vue/shared'\nimport {track,trigger} from './effect'\nimport { reactive } from './reactive'\n// v8\u5783\u573E\u56DE\u6536\nexport const enum ReactiveFlags {\n    IS_REACTIVE = \"__v_isReactive\"\n}\n\nexport function isReactive (value) {\n    return value && value[ReactiveFlags.IS_REACTIVE]\n}\n\nexport const baseHandler = {\n    get(target,key,receiver){\n        if(key === ReactiveFlags.IS_REACTIVE) {\n            return true\n        }\n\n        track(target,key)\n        \n        let res = Reflect.get(target,key,receiver)\n\n        if(isObject(res)){\n            return reactive(res)\n        }\n\n        return res\n    },\n    set(target,key,value,receiver){\n        let oldValue = target[key]\n        let result = true\n        if(oldValue !== value){\n            result = Reflect.set(target,key,value,receiver)\n            trigger(target,key,value)\n            return result\n        }\n\n    }\n}", "import { isObject } from \"@vue/shared\";\nimport { track } from \"./effect\";\nconst reactiveMap = new WeakMap(); // key\u5FC5\u987B\u662F\u5BF9\u8C61 \u5F31\u5F15\u7528\nimport { ReactiveFlags, baseHandler } from \"./baseHandler\";\nexport function reactive(target) {\n  if (!isObject(target)) {\n    return target;\n  }\n\n  if (target[ReactiveFlags.IS_REACTIVE]) {\n    return target;\n  }\n\n  // \u83B7\u53D6\u7F13\u5B58\n  const existing = reactiveMap.get(target);\n  if (existing) return existing;\n\n  // es6 proxy\n  const proxy = new Proxy(target, baseHandler);\n\n  return proxy;\n}\n\n// \u53BBproxy\u4E0A\u53D6aliasName \u4F1A\u6267\u884Cget\u65B9\u6CD5\n// \u4F46\u662FaliasName \u662F\u57FA\u4E8Ename\u5C5E\u6027 \u539F\u5219\u4E0A\u5E94\u8BE5\u53D6name\u4E0A\u53D6\u503C\n// \u7136\u800Cthis.aliasName \u6CA1\u6709\u89E6\u53D1proxy\u7684get \u4E5F\u5C31\u610F\u5473\u7740\u4FEE\u6539name\u4E0D\u4F1A\u89E6\u53D1\u54CD\u5E94\n", "import { isFunction } from \"@vue/shared\";\nimport { activeEffect, ReactiveEffect, track, trackEffects } from \"./effect\";\n\nexport function computed(getterOrOptions,){\n    let isGetter =  isFunction(getterOrOptions)\n    let getter;\n    let setter;\n    const fn = ()=>{ console.warn('computed is readonly')}\n\n    if(isGetter){\n        getter = getterOrOptions\n        setter = fn\n    }else{\n        getter = getterOrOptions.get;\n        setter = getterOrOptions.set || fn\n    }\n\n    return new ComputedRefImpl(getter,setter)\n\n}\n\nclass ComputedRefImpl {\n    private _value\n    private _dirty = true\n    private effect;\n    public deps;\n    constructor(public getter,public setter){\n        // \u62FF\u5230effect\u5B9E\u4F8B \u8BA9\u51FD\u6570\u6267\u884C\n       this.effect =  new ReactiveEffect(getter,()=>{\n           if(!this._dirty){\n               this._dirty = true\n           }\n       })\n    }\n\n    get value(){ // \u53D6\u503C\u7684\u65F6\u5019\u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\n        if(activeEffect){\n            trackEffects(this.deps || (this.deps = new Set));\n        }\n        if(this._dirty){ // \u5982\u679C\u662F\u810F\u503C, \u6267\u884C\u51FD\u6570\n            this._dirty = false;\n            this._value = this.effect.run(); \n        }\n        return this._value; \n    }\n\n    set value(newValue){\n        this.setter(newValue)\n    }\n}", "import { ReactiveEffect } from \"./effect\";\nimport { isReactive } from \"./baseHandler\";\nimport { isFunction ,isObject} from \"@vue/shared\";\n\nfunction traversal(value,set = new Set()) { // set \u7528\u6765\u5B58\u653E\u8FED\u4EE3\u8FC7\u7684\u5BF9\u8C61\n    // \u9012\u5F52\n\n    if(!isObject(value)) {\n        return value;// \u7EC8\u6B62\u6761\u4EF6\n    }\n    if(set.has(value)) {\n        return value\n    }\n    set.add(value);// \u6B64\u5BF9\u8C61\u5DF2\u7ECF\u88AB\u8FED\u4EE3\u8FC7\u4E86\n    for(let key in value) {\n        traversal(value[key],set)\n    }\n\n    return value;\n}\n\nexport function watch(source,cb){\n    let get \n    if(isReactive(source)){\n        // \u521B\u5EFA\u4E00\u4E2Aeffect \u8BA9\u8FD9\u4E2Aeffect\u6536\u96C6source\u4E2D\u6240\u6709\u5C5E\u6027\n\n        get = ()=> traversal(source)\n        \n    }else if (isFunction(source)){\n        get = source\n    }\n\n    let oldValue\n    let cleanup;\n    const onCleanup =(fn)=>{  \n        cleanup = fn\n    }\n    const job = ()=>{\n        if(cleanup) cleanup(); // \u5982\u679Ccleanup\u6709\u503C \u5219\u662F\u4E0A\u4E00\u6B21\u8D4B\u4E88\u7684\n        // \u6570\u636E\u53D8\u5316\u540E\u91CD\u65B0\u8C03\u7528effect.run\u51FD\u6570\uFF0C\u4F1A\u83B7\u53D6\u6700\u65B0\u7684\u503C\n        let newValue = effect.run()\n        cb(newValue,oldValue,onCleanup)\n    }\n\n    const effect = new ReactiveEffect(get,job)\n    // \u9ED8\u8BA4\u8C03\u7528run\u65B9\u6CD5\u4F1A\u6267\u884Cget\u51FD\u6570\uFF0C\u6B64\u65F6source\u4F5C\u4E3A\u4E86\u7B2C\u4E00\u6B21\u7684\u8001\u503C\n    oldValue = effect.run()\n}", "import { isObject } from \"@vue/shared\";\nimport { trackEffects, triggerEffects } from \"./effect\";\nimport { reactive } from \"./reactive\";\n\nexport function ref(value){\n    return new RefImpl(value)\n}\n\nexport function toRefs(object){\n    let result = {};\n\n    for(let key in object){\n        result[key] = toRef(object,key);\n    }\n\n    return result\n}\n\nexport function toRef(object,key){\n    return new ObjectRefImpl(object,key)\n}\n\nexport function toReactive (value) {\n    return isObject(value) ? reactive(value):value\n}\n\nclass ObjectRefImpl{\n    constructor(public object,public key){\n\n    }\n\n    get value(){\n        return this.object[this.key]\n    }\n\n    set value(newValue){\n        this.object[this.key] = newValue\n    }\n}\n\nclass RefImpl {\n    private _value;\n    private dep = new Set()\n    constructor(public rawValue) {\n        // rawValue \u53EF\u80FD\u662F\u4E00\u4E2A\u5BF9\u8C61\n\n        this._value = toReactive(rawValue)\n    }\n\n    get value(){\n        // \u9700\u8981\u53D6\u503C \u9700\u8981\u4F9D\u8D56\u6536\u96C6 \u9700\u8981\u6536\u96C6\u5BF9\u5E94\u7684\u4F9D\u8D56\n        trackEffects(this.dep || (this.dep = new Set()))\n        return this._value\n    }\n\n    set value(newValue){\n        if(newValue != this.rawValue){\n            this._value  = toReactive(newValue)\n            this.rawValue = newValue\n            triggerEffects(this.dep)\n        }\n    }\n\n}"],
  "mappings": "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",
  "names": []
}
